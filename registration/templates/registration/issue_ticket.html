{% extends "base.html" %}
{% load i18n humanize %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block content %}
<table id="issue-ticket" class="table table-hover">
<thead>
    <tr>
    <th>이름</th>
    <th>전화번호(이메일)</th>
    <th>입장코드</th>
    <th>관리</th>
    </tr>
</thead>
<tbody>
    {% for user in registration %}
    <tr>
        <td>{{ user.name }}</td>
        <td>{{ user.phone_number }}</td>
        <td>{{ user.transaction_code }}</td>
    <td>
        <div class="btn-group">
            <button type="button" class="btn btn-success btn-filter" onclick="printLabelPopup('{{ user.name }}', '{{ user.top_size }}')">발권</button>
            <button type="button" class="btn btn-warning btn-filter">재발권</button>
            <button type="button" class="btn btn-default btn-filter" onclick="location.href='/admin/registration/registration/'">관리</button>
        </div>
    </td>
    </tr>
    {% endfor %}
</tbody>
</table>

<script src="{% static "components/datatables.net/js/jquery.dataTables.min.js" %}" charset="utf-8"></script>
<script src="{% static "components/datatables.net-bs/js/dataTables.bootstrap.min.js" %}" charset="utf-8"></script>
<link href="{% static "components/datatables.net-bs/css/dataTables.bootstrap.min.css" %}" rel="stylesheet">

<script type="text/javascript">
$(document).ready( function () {
    $('#issue-ticket').DataTable({
        bInfo: true,
        bLengthChange: true,
        lengthMenu: [[50, 100, 200], [50, 100, 200]],
        order: [[ 0, 'asc' ]],
        paging: true,
        searching: true,
    });
} );

function issueTicketConfirm() {
    // send ajax request to comfirm issue ticket...
}

function printLabelPopup(name, topSize) {
    var printWindow = window.open('', '', 'width=600, height=400');
    var fontSize = '1em';

    HTML = '';
    if (name.length < 5) {
        fontSize = '5em';
    } else if (name.length < 10) {
        fontSize = '4em';
    } else {
        fontSize = '3em';
    }
    HTML += ' \
    <div class="ui brother-label"> \
        <p class="ui name">' + name + '</p> \
    </div> \
    <div class="ui brother-label"> \
        <p class="ui name">' + topSize + '</p> \
    </div> \
    <style> \
    .brother-label { \
        margin: 0 auto; \
        padding: 0 auto; \
        width: 88mm; \
        height: 27mm; \
    } \
    .name{ \
        font-size: ' + fontSize + '; \
        font-weight: bold; \
        text-align: center; \
        letter-spacing: 1rem;\
    } \
    @media print { \
        body, html, p{ \
            margin: 0mm !important; \
            padding: 0mm !important;\
        } \
        @page{ \
            margin: 0mm !important; \
            padding: 0mm !important; \
        } \
    } \
    </style>';
    printWindow.document.write(HTML);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
    printWindow.close();
}
</script>
{% endblock %}
